{% load static %}
{% load compress %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="pl">

<head>
    <title>Matematyczne Internetowe Koło Olimpijskie – MIKO</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Społeczność, gdzie poznasz innych ambitnych młodych matematyków, poszerzysz swoją wiedzę i przygotujesz się do Olimpiady Matematycznej.">
    <meta name="author" content="Matematyczne Internetowe Koło Olimpijskie">
    {% compress css %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="{% static 'badges.css' %}">
    {% endcompress %}
    {% compress js %}
    <script src="{% static 'script.js' %}"></script>
    {% endcompress %}
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <meta property="og:type" content="website">
    <meta property="og:title" content="Matematyczne Internetowe Koło Olimpijskie – MIKO">
    <meta property="og:description" content="Społeczność, gdzie poznasz innych ambitnych młodych matematyków, poszerzysz swoją wiedzę i przygotujesz się do Olimpiady Matematycznej.">
    <meta property="og:url" content="https://mikomath.org/">
    <meta property="og:locale" content="pl_PL">
    <meta property="og:image" content="https://mikomath.org/media/cards/index.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="twitter:title" content="Matematyczne Internetowe Koło Olimpijskie – MIKO">
    <meta property="twitter:description" content="Społeczność, gdzie poznasz innych ambitnych młodych matematyków, poszerzysz swoją wiedzę i przygotujesz się do Olimpiady Matematycznej.">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:image" content="https://mikomath.org/media/cards/index.png">
</head>

<body>
    {% include "header.html" %} 

    <section id="feed" style="display: flex; flex-direction: row; gap: 32px;">
        <div class="column_right" style="flex: 1; flex-wrap: wrap; word-break:break-word;">
            <h1 style="margin-top: 0px;">Aktualności</h1>
            <hr style="margin-bottom: 20px">
            {% for post in posts %}
            <div class="post">
                <div class="post-header">
                    <h2 id="post_title">{{ post.title }}</h2>
                    <p>{{ post.date }}, {{ post.time }}</p>
                </div>
                <h3 id="post_subtitle">{{ post.subtitle }}</h3>
                <div style="margin-bottom: 8px;">
                    {% if post.tags %}
                        <span style="font-size: 0.95em; color: #666;">Tagi:
                        {% for tag in post.tags %}
                            <a href="?tag={{ tag.slug }}" style="background: #e0e0e0; border-radius: 8px; padding: 2px 8px; margin-right: 4px; text-decoration: none; color: #333; font-size: 0.95em;">#{{ tag.name }}</a>
                        {% endfor %}
                        </span>
                    {% endif %}
                </div>
                <hr style="border: none; height: 2px; margin-bottom: 10px">
                <p>{% if post.authors|length > 1%}
                        <strong>Autorzy:</strong>
                    {% else %}
                        <strong>Autor:</strong>
                    {% endif %}
                    {% for author in post.authors %}
                        <a href="/publicprofile/{{ author.username }}">{{ author.full_name }}</a>
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
                <div class="post_content">
                    {{ post.content }}
                </div>
                {% if post.file %}
                    <div style="display: flex; margin-top: 10px;">
                    <a href="{{ post.file.url }}" style="text-decoration: none"><div class="badge badge-light">
                        <span class="material-symbols-rounded badge-icon">download</span>
                        {{ post.file.name }}</div></a>
                    </div>
                {% endif %}
                {% if post.images|length > 0 %}
                    <div class="images">
                        {% for image in post.images %}
                        <img src="/media/{{ image.url }}" alt="{{ image.alt_text }}">
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            {% empty %}
                <p>Brak postów.</p>
            {% endfor %}

            <!-- Paginacja -->
            {% if page_obj.has_other_pages %}
            <nav aria-label="Paginacja" style="margin-top: 24px; text-align: center;">
                <ul class="pagination" style="display: inline-flex; list-style: none; padding: 0;">
                    {% if page_obj.has_previous %}
                        <li><a href="?{% if active_tag %}tag={{ active_tag }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}page={{ page_obj.previous_page_number }}" style="padding: 6px 12px;">&laquo; Poprzednia</a></li>
                    {% endif %}
                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <li><span style="padding: 6px 12px; font-weight: bold; color: #1976d2;">{{ num }}</span></li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <li><a href="?{% if active_tag %}tag={{ active_tag }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}page={{ num }}" style="padding: 6px 12px;">{{ num }}</a></li>
                        {% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                        <li><a href="?{% if active_tag %}tag={{ active_tag }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}page={{ page_obj.next_page_number }}" style="padding: 6px 12px;">Następna &raquo;</a></li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
        <!-- Panel filtrów i sortowania po prawej stronie -->
        <aside style="min-width: 220px; max-width: 260px; background: #f7f7f7; border-radius: 12px; padding: 18px 16px; margin-top: 0.5em; height: fit-content; box-shadow: 0 2px 8px rgba(0,0,0,0.07);">
            <h3 style="margin-top: 0; font-size: 1.15em; color: #1976d2; letter-spacing: 0.5px;">Filtruj aktualności</h3>
            <form method="get" id="filterForm">
                <div style="margin-bottom: 1em;">
                    <label for="tag" style="font-weight: 500;">Tag:</label>
                    <select name="tag" id="tag" onchange="document.getElementById('filterForm').submit();" style="width: 100%; padding: 4px 8px; border-radius: 6px; border: 1px solid #ccc;">
                        <option value="">Wszystkie</option>
                        {% for tag in tags %}
                        <option value="{{ tag.slug }}" {% if tag.slug == active_tag %}selected{% endif %}>{{ tag.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div style="margin-bottom: 1em;">
                    <label for="sort" style="font-weight: 500;">Sortuj:</label>
                    <select name="sort" id="sort" onchange="document.getElementById('filterForm').submit();" style="width: 100%; padding: 4px 8px; border-radius: 6px; border: 1px solid #ccc;">
                        <option value="date_desc" {% if sort == 'date_desc' %}selected{% endif %}>Najnowsze</option>
                        <option value="date_asc" {% if sort == 'date_asc' %}selected{% endif %}>Najstarsze</option>
                    </select>
                </div>
            </form>
        </aside>
    </section>
    {% include "footer.html" %}

</body>

<script>function toggleImageSize() {
  const images = document.querySelectorAll('div.images img');

  images.forEach(img => {
    img.style.cursor = 'pointer';
    img.style.width = '40%';

    img.addEventListener('click', function() {
      if (this.style.width === '40%') {
        this.style.width = '100%';
      } else {
        this.style.width = '40%';
      }
    });
  });
}

// Call the function when the page loads
document.addEventListener('DOMContentLoaded', toggleImageSize);</script>

<script>const backgroundDiv = document.getElementById('background-image');
const images = ['MIKO_BG1.webp', 'MIKO_PICTURE.webp'];
let currentIndex = 0;

function changeBackground() {
    currentIndex = (currentIndex + 1) % images.length;
    const nextImage = `/static/${images[currentIndex]}`; // Direct string concatenation

    backgroundDiv.style.transition = 'background-image 1s ease-in-out';
    backgroundDiv.style.backgroundImage = `linear-gradient(to right, rgb(6,49,62), rgba(255,255,255,0), rgba(255,255,255,0), rgba(255,255,255,0)), url('${nextImage}')`; // Template literal here
}

// Change background every 5 seconds
setInterval(changeBackground, 5000);</script>
</html>