{% load static %}
{% load compress %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="pl">

<head>
    <title>Matematyczne Internetowe Koło Olimpijskie – MIKO</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Społeczność, gdzie poznasz innych ambitnych młodych matematyków, poszerzysz swoją wiedzę i przygotujesz się do Olimpiady Matematycznej.">
    <meta name="author" content="Matematyczne Internetowe Koło Olimpijskie">
    {% compress css %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="{% static 'badges.css' %}">
    <link rel="stylesheet" href="{% static 'mainSite/news.css' %}">
    {% endcompress %}
    {% compress js %}
    <script src="{% static 'script.js' %}"></script>
    {% endcompress %}

    <style>
    /* Filter aside styling */
    .filter-aside {
        background: linear-gradient(180deg, #ffffff, #f7fbfb);
        border-left: 3px solid #06313e; /* match site accent */
        padding: 14px;
        border-radius: 8px;
        box-shadow: 0 6px 18px rgba(6,49,62,0.06);
        max-width: 280px;
        margin-left: 20px;
        position: sticky;
        top: 96px;
        height: fit-content;
        font-family: 'Rubik', sans-serif;
    }
    .filter-title { color: #06313e; margin: 0 0 10px 0; font-weight:700; font-size:1.05rem; }
    .filter-label { display:block; color:#06313e; margin-bottom:6px; font-size:0.92rem; }
    .filter-select { width:100%; padding:8px 10px; border:1px solid rgba(6,49,62,0.12); border-radius:6px; background:#fff; color:#06313e; }
    .filter-select:focus { outline: none; box-shadow: 0 0 0 3px rgba(6,49,62,0.06); }

    /* File badge / link improvements */
    .post-file { margin-top:12px; }
    .post-file-link { text-decoration:none; display:block; }
    .post-file-link .badge { display:flex; align-items:center; gap:12px; padding:8px 12px; }
    .post-file-link .file-name { display:inline-block; max-width:100%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; vertical-align:middle; font-weight:600; color:#06313e; }
    .post-file-link .material-symbols-rounded { background:#06313e; border-radius:50%; color:#fff; padding:6px; font-size:18px; line-height:1; }

    /* Images small improvements */
    .images img { transition: all 0.18s ease; max-width:100%; height:auto; margin:8px 6px; border-radius:6px; box-shadow: 0 6px 20px rgba(6,49,62,0.07); }

    /* Responsive: move filter under content on small screens */
    @media (max-width:900px){
        .filter-aside{ position: static; width:100%; margin:12px 0 0 0; }
    }
    </style>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <meta property="og:type" content="website">
    <meta property="og:title" content="Matematyczne Internetowe Koło Olimpijskie – MIKO">
    <meta property="og:description" content="Społeczność, gdzie poznasz innych ambitnych młodych matematyków, poszerzysz swoją wiedzę i przygotujesz się do Olimpiady Matematycznej.">
    <meta property="og:url" content="https://mikomath.org/">
    <meta property="og:locale" content="pl_PL">
    <meta property="og:image" content="https://mikomath.org/media/cards/index.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="twitter:title" content="Matematyczne Internetowe Koło Olimpijskie – MIKO">
    <meta property="twitter:description" content="Społeczność, gdzie poznasz innych ambitnych młodych matematyków, poszerzysz swoją wiedzę i przygotujesz się do Olimpiady Matematycznej.">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:image" content="https://mikomath.org/media/cards/index.png">
</head>

<body>
    {% include "header.html" %} 

    <section id="feed">
        <div class="column_right">
            <h1 class="news-title">Aktualności</h1>
            <hr class="news-hr">
            {% for post in posts %}
            <div class="post">
                <div class="post-header">
                    <h2 id="post_title">{{ post.title }}</h2>
                    <p>{{ post.date }}, {{ post.time }}</p>
                </div>
                <h3 id="post_subtitle">{{ post.subtitle }}</h3>
                <div class="news-mb-8">
                    {% if post.tags %}
                        <span class="post-tags">Tagi:
                        {% for tag in post.tags %}
                            <a href="?tag={{ tag.slug }}" class="post-tag-link">#{{ tag.name }}</a>
                        {% endfor %}
                        </span>
                    {% endif %}
                </div>
                <hr class="post-header-hr">
                <p>{% if post.authors|length > 1%}
                        <strong>Autorzy:</strong>
                    {% else %}
                        <strong>Autor:</strong>
                    {% endif %}
                    {% for author in post.authors %}
                        {{ author.full_name }}
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
                <div class="post_content">
                    {{ post.content }}
                </div>

                {% if post.images|length > 0 %}
                    <div class="images">
                        {% for image in post.images %}
                        <img src="/media/{{ image.url }}" alt="{{ image.alt_text }}" class="img-small">
                        {% endfor %}
                    </div>
                {% endif %}

                {% if post.file %}
                    <div class="post-footer">
                        <a href="{{ post.file.url }}" class="post-file-link" title="{{ post.file.name }}">
                            <div class="badge" aria-hidden="true">
                                <span class="material-symbols-rounded badge-icon">download</span>
                                <span class="file-name" title="{{ post.file.name }}">{{ post.file.name }}</span>
                            </div>
                        </a>
                    </div>
                {% endif %}

            </div>
            {% empty %}
                <p>Brak postów.</p>
            {% endfor %}

            <!-- Paginacja -->
            {% if page_obj.has_other_pages %}
            <nav aria-label="Paginacja" class="news-pagination-nav">
                <ul class="pagination">
                    {% if page_obj.has_previous %}
                        <li><a href="?{% if active_tag %}tag={{ active_tag }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}page={{ page_obj.previous_page_number }}" class="pagination-link">&laquo; Poprzednia</a></li>
                    {% endif %}
                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <li><span class="pagination-current">{{ num }}</span></li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <li><a href="?{% if active_tag %}tag={{ active_tag }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}page={{ num }}" class="pagination-link">{{ num }}</a></li>
                        {% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                        <li><a href="?{% if active_tag %}tag={{ active_tag }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}page={{ page_obj.next_page_number }}" class="pagination-link">Następna &raquo;</a></li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
        <!-- Panel filtrów i sortowania po prawej stronie -->
        <aside class="filter-aside">
            <h3 class="filter-title">Filtruj aktualności</h3>
            <form method="get" id="filterForm">
                <div>
                    <label for="tag" class="filter-label">Tag:</label>
                    <select name="tag" id="tag" onchange="document.getElementById('filterForm').submit();" class="filter-select">
                        <option value="">Wszystkie</option>
                        {% for tag in tags %}
                        <option value="{{ tag.slug }}" {% if tag.slug == active_tag %}selected{% endif %}>{{ tag.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div style="margin-top:10px;">
                    <label for="sort" class="filter-label">Sortuj:</label>
                    <select name="sort" id="sort" onchange="document.getElementById('filterForm').submit();" class="filter-select">
                        <option value="date_desc" {% if sort == 'date_desc' %}selected{% endif %}>Najnowsze</option>
                        <option value="date_asc" {% if sort == 'date_asc' %}selected{% endif %}>Najstarsze</option>
                    </select>
                </div>
            </form>
        </aside>
    </section>
    {% include "footer.html" %}

</body>

<script>function toggleImageSize() {
  const images = document.querySelectorAll('div.images img');

  images.forEach(img => {
    img.style.cursor = 'pointer';
    // Ensure initial class exists
    if(!img.classList.contains('img-small') && !img.classList.contains('img-full')){
      img.classList.add('img-small');
    }

    img.addEventListener('click', function() {
      if (this.classList.contains('img-small')) {
        this.classList.remove('img-small');
        this.classList.add('img-full');
      } else {
        this.classList.remove('img-full');
        this.classList.add('img-small');
      }
    });
  });
}

// Call the function when the page loads
document.addEventListener('DOMContentLoaded', toggleImageSize);</script>

<script>const backgroundDiv = document.getElementById('background-image');
const images = ['MIKO_BG1.webp', 'MIKO_PICTURE.webp'];
let currentIndex = 0;

function changeBackground() {
    currentIndex = (currentIndex + 1) % images.length;
    const nextImage = `/static/${images[currentIndex]}`; // Direct string concatenation

    backgroundDiv.style.transition = 'background-image 1s ease-in-out';
    backgroundDiv.style.backgroundImage = `linear-gradient(to right, rgb(6,49,62), rgba(255,255,255,0), rgba(255,255,255,0), rgba(255,255,255,0)), url('${nextImage}')`; // Template literal here
}

// Change background every 5 seconds
setInterval(changeBackground, 5000);</script>
</html>
